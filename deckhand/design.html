<html>
<head>
<meta charset="UTF-8">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Della+Respira&family=Lobster+Two:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
<script src="html2canvas.js"></script>
<link rel="stylesheet" href="design.css">
</head>

<body>

<h2>DeckHand (v0.9.11)</h2>

<p>
    DeckHand is a pirate themed deck builder game for 2 to 4 players. There are <span id="nbCards"></span> cards in 
    the game with <span id="nbDesign"></span>  unique designs.
</p>

<div style="clear:both;padding-top:20px">

<div id="distribution"></div>
<button id="genPDF">Create MB Print compatible PDF</button>

</div>

<div style="display: flex;">
    <div class="booklet" id="face" title="booklet-face">
        <div class="innerBooklet">     
            <div>
            <h3 style="margin-top:0">
                Set up <span style="float: right; font-size: 10px; margin-top: -6px; margin-right: -3px;">DeckHand Rules 1/2</span>
            </h3>
            <p>Contains 72 cards and this booklet. Suited for 2 to 4 players.</p>
         
             <ol>
                 <li>Gather about 20 Treasure tokens into a bank. We recommend using beans. Give a Treasure to each player.</li>
                 <li>
                     Each player receives a deck of 2 Fist Fight and 2 Celebrate.
                     Remove all remaining Fist Fight and Celebrate from the game.
                 </li>
                 <li>
                     Remaining cards are shuffled and form the supply deck. Put 6 supply cards face up
                     in the center of the table: this is the supply. There should always be 6 cards face up. Replace them as you go.
                 </li>
             </ol>

             <h3>Unfolding of the game</h3>

             <p>
                 A random player start, then each player in turn:
             </p>
         
             <ol>
                 <li>Apply effects that happen at the beginning of turn <img class="rule-icon" src="icons/bookmark-yellow.svg" />.</li>
                 <li>Discard your hand and draw 3 cards.</li>
                 <li>You have 2 of any actions during your turn which are:
                     <ol>
                         <li>Playing a card: Apply its effects <b>then</b> put it in your discard.</li>
                         <li>Buying a card from the supply: It goes in your discard.</li>
                     </ol>
                  </li>
                 <li>When your deck is empty immediately shuffle your discard into a new deck. This takes precedence over
                    <b>any</b> other effect.
                 </li>
             </ol>
            </div>

             <div style="margin-bottom: 20px; position: relative;">
                <img src="marketing/board.png" width="105%" style="margin-left: -2.5%" />
                <ol id="illustration">
                    <li>Supply deck and supply.</li>
                    <li>Your hand and Treasures.</li>
                    <li>Your deck.</li>
                    <li>Your discard.</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="booklet" id="back"  title="booklet-back">
        <div class="innerBooklet">
            <div>
            <h3 style="margin-top:0">
                General rules <span style="float: right; font-size: 10px; margin-top: -6px; margin-right: -3px;">DeckHand Rules 2/2</span>
            </h3>
        
            <ul>
                <li>Treasures are the money that allow you to buy cards from the supply. Card cost is the chest icon at the bottom right <img class="rule-icon" src="icons/chest.svg" />.</li>
                <li><b>+1 Card:</b> Draw a card from your deck immediately.</li>
                <li><b>+1 Action:</b> One extra action of any kind during your turn.</li>
                <li><b>+1 Treasure:</b> Take a treasure from the bank immediately.</li>
                <li><b>+1 Buy:</b> You may buy a card without using an action this turn.</li>
                <li>+1 Supply refresh: You may change one card from the supply this turn. Put the old one at the bottom of the supply deck.</li>
                <li>+1 Discard: Discard a card immediately.</li>
                <li>Effects on cards have to be applied <b>in order</b>.</li>
                <li>Cards have 3 possible types: Attack, Structure, Adventure.</li>
                <li>Text that says "if you have" checks cards currently in your hand.</li>
                <li>Cards being played are neither in your hand nor your discard.</li>
                <li>You can only Discard cards in your hand.</li>
                <li>Your discard is face up and can be inspected by anybody. The number of cards owned by players is public information.</li>
                <li>You cannot own less than 4 cards.</li>
                <!-- <li>The flag <img class="rule-icon" src="icons/flag.svg" /> indicates an effect at the beginning of turn.</li> -->
                <li>When a deck/discard/hand is too small for an effect, you can still apply the effect for any amount that is not 0.</li>
            </ul>
        
            <h3>End of the game</h3>
        
            <p>The game ends when any player owns more than 15 cards. He finishes his turn and each other player plays a last turn but with only one starting action.
               Count the number of hooks in each deck <img class="rule-icon" src="icons/hook.svg" />. The player with the most hooks wins the game. 
               If there is equality, the player with the most Treasures wins, then the player that ended the game.
            </p>
            </div>

            <div>
                Information and update: https://bit.ly/dk-h<br>
            </div>
        </div>
    </div>
</div>

<button onclick="downloadBookletFace()">Download booklet face</button>
<button onclick="downloadBookletBack()">Download booklet back</button>



<!-- <div style="clear: both;">
    <img width="240" src="https://raw.githubusercontent.com/batiste/batiste.github.io/03451c0b33ddc125cb38a1750487a939a1397f1c/pirates-2/back.png">
    <img src="./back.png" width="240">
</div> -->

<div id="cards"></div>

</body>

<script>
    var cards = [

    {
            'title': 'Fist Fight',
            'text': '+1 Treasure.',
            'img': 'attacks/fist-fight.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '1',
            'cost': '1',
            'amount': 2 * 4
        },

        {
            'title': 'Celebrate',
            'text': '+1 Card.<br>+1 Supply refresh.',
            'img': 'adventures/celebrate.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '1',
            'cost': '1',
            'amount': 2 * 4
        },

        {
            'title': 'Tavern',
            'text': '+1 Card if you have an Adventure.<br>+1 Treasure if you have an Attack.<br>+1 Action if you have a Structure.',
            'img': 'adventures/tavern-3.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '1',
            'cost': '1',
            'amount': 3,
        },

        {
            'title': 'Quick Shot',
            'text': '+1 Treasure.<br>+1 Action if you have an Attack.',
            'img': 'attacks/dual-pistol.png',
            'type': 'attack',
            'subtype': 'Attack',
            'cost': 1,
            'victory': 1,
            'amount': 3,
        },

        {
            'title': 'Poisoned Grog',
            'text': '+1 Treasure.<br>If you Discard this card: +1 Treasure',
            'img': 'attacks/poison.png',
            'type': 'attack',
            'subtype': 'Attack',
            'cost': 1,
            'victory': 1,
            'amount': 1,
        },

        {
            'title': 'Beach Bum',
            'text': '+2 Treasures if you are one of the player that owns the least amount of cards.',
            'img': 'adventures/beach-bum.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '1',
            'cost': '1',
            'amount': 1
        },

        {
            'title': 'Governor’s Wedding',
            'text': '+1 Treasure.<br>On his next turn, target player gets +1 Buy and must give you a Treasure before his first buy.',
            'img': 'structures/wedding.png',
            'type': 'structure',
            'subtype': 'Structure',
            'cost': 1,
            'victory': 1,
            'amount': 2,
        },

        {
            'title': 'Haggling',
            'text': '+1 Supply refresh, +1 Buy.<br>Your next buy this turn cost 1 less.',
            'img': 'attacks/haggling.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '1',
            'cost': '1',
            'amount': 3,
        },

        {
            'title': 'Useless Totem',
            'text': 'Reveal this card: Change its type until you Discard it. This is not an action. It can be done at any time and only once per turn.',
            'img': 'structures/totem.png',
            'type': 'structure',
            'subtype': 'Structure',
            'victory': '2',
            'cost': '1',
            'amount': 2
        },

        {
            'title': 'Typhoon',
            'text': '+1 Card, +1 Discard, +1 Treasure. Everybody move a card from their discard or a blind top deck to their left neighbors discard.',
            'img': 'adventures/tornado.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '2',
            'cost': '2',
            'amount': 2,
        },

        {
            'title': 'Alchemist',
            'text': 'Discard any number of cards, get that many Treasures.<br>+1 Card.',
            'img': 'adventures/alchemist.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'cost': 2,
            'victory': 2,
            'amount': 1,
        },

        {
            'title': 'Hideout',
            'text': '+2 Cards, +1 Treasure.<br>The first time you Discard Hideout you may not and still pretend it happened.',
            'img': 'structures/hideout.png',
            'type': 'structure',
            'subtype': 'Structure',
            'cost': '2',
            'victory': '2',
            'amount': 3
        },

        {
            'title': 'Harbor Market',
            'text': '+2 Treasures.<br>OR<br>+1 Treasure, +1 Buy.',
            'img': 'structures/market-super-format.png',
            'type': 'structure',
            'subtype': 'Structure',
            'cost': '2',
            'victory': '2',
            'amount': 4
        },

        {
            'title': 'Exploration',
            'text': '+1 Action if you have an Adventure.<br>+1 Card, +1 Treasure.',
            'img': 'adventures/exploration.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'cost': '2',
            'victory': '2',
            'amount': 3
        },

        {
            'title': 'Going Ape',
            'text': '+1 Action, +1 Supply Refresh.<br>Swap Going Ape or a card from your hand with a card of equal cost from the supply. The new card goes in your hand.',
            'img': 'attacks/silverback.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '2',
            'cost': '2',
            'amount': 2
        },

        {
            'title': 'Haunted Cave',
            'text': '+2 Cards.<br>+1 Treasure for each Attack in your hand, but no more than 3.',
            'img': 'attacks/infested-cave.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '2',
            'cost': '2',
            'amount': 2
        },

        {
            'title': 'Lost Expedition',
            'text': 'Put a card from any discard aside with a Treasure on it. When the discard is shuffled take the Treasure and put the card back in the new discard.',
            'img': 'adventures/lost-expedition.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'cost': '2',
            'victory': '2',
            'amount': 3
        },

        {
            'title': 'Extravagance',
            'text': '+2 Buy.<br>OR<br>+1 Treasure, +1 Buy.',
            'img': 'adventures/extravagance-2.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '2',
            'cost': '2',
            'amount': 2
        },

        {
            'title': 'Shipyard',
            'text': '+1 Treasure. You can’t gain more than 3 extra actions this turn.<br>+1 Action for each structure in your discard.',
            'img': 'structures/shipyard.png',
            'type': 'structure',
            'subtype': 'Structure',
            'victory': '2',
            'cost': '2',
            'amount': 2
        },

        {
            'title': 'Walk the Plank',
            'text': 'Put a card from your hand or discard at the bottom of the supply: +3 Treasures.<br>OR<br>+1 Treasure.',
            'img': 'attacks/plank.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '2',
            'cost': '2',
            'amount': 2
        },

        {
            'title': 'Wind in Sails',
            'text': '+1 Card.<br>At the start of your turn if this card is in your discard: Draw an extra card during your initial draw.',
            'img': 'adventures/wind.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '2',
            'cost': '2',
            'amount': 1,
            'discard': true,
        },

        {
            'title': 'Bank',
            'text': '+2 Treasures.<br>If you discard this card: +1 Action.',
            'img': 'structures/bank.png',
            'type': 'structure',
            'subtype': 'Structure',
            'victory': '2',
            'cost': '2',
            'amount': 1,
            // 'discard': true,
        },

        {
            'title': 'Seaside Citadel',
            'text': 'You can’t gain more than 3 extra actions this turn.<br>+1 Card, +2 Actions.',
            'img': 'structures/citadel.png',
            'type': 'structure',
            'subtype': 'Structure',
            'cost': '3',
            'victory': '2',
            'amount': 2
        },

        {
            'title': 'Voodoo Curse',
            'text': 'Reveal the top 3 cards of the target player’s deck. Put one in their discard, then apply its effects as if you just played it.',
            'img': 'attacks/spell.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '2',
            'cost': '3',
            'amount': 2
        },

        {
            'title': 'Smuggler’s Cache',
            'text': '+1 Treasure.<br>At the start of your turn if this card is in your discard: +1 Treasure.',
            'img': 'structures/smugglers-cache.png',
            'type': 'structure',
            'subtype': 'Structure',
            'victory': '2',
            'cost': '3',
            'amount': 2,
            'discard': true,
        },

        {
            'title': 'Crooked Merchant',
            'text': 'Swap 2 cards between 2 discard as long as the cost difference is less than 2.<br>OR<br>+1 Treasure.',
            'img': 'attacks/merchant.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '2',
            'cost': '3',
            'amount': 2
        },

        {
            'title': 'Merfolk Mercenary',
            'text': 'Pay 1 Treasure: Reveal the top 2 cards of the supply and put one that cost less than 4 in your discard.',
            'img': 'adventures/merfolk-2.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '2',
            'cost': '3',
            'amount': 2
        },

        {
            'title': 'Kraken',
            'text': '+1 Action. Steal a Treasure from any players. Put up to 2 cards from any discard at the bottom of their owner’s deck.',
            'img': 'attacks/kraken.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '3',
            'cost': '4',
            'amount': 1
        },

        {
            'title': 'Skull island',
            'text': 'Every player reveals the top card of their deck: you may swap one with another from the supply as long as the cost difference is less than 3.',
            'img': 'structures/skull.png',
            'type': 'structure',
            'subtype': 'Structure',
            'victory': '3',
            'cost': '4',
            'amount': 1
        },

        {
            'title': 'Treasure Hunt',
            'text': '+1 Action, +1 Buy,<br>+1 Card, +1 Treasure.',
            'img': 'adventures/hunt.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '3',
            'cost': '4',
            'amount': 1
        },

    ]

    all = []
    var j = 0;
    var amount = 0;
    var distribution = {'attack': 0, 'structure': 0, 'adventure': 0, 1: 0, 2: 0, 3: 0, 4: 0, nb_cards_necessary_total:(15 * 4 + 6 + 2)}

    cards.forEach((c) => {
        var extra = ""
        c['id'] = j;
        amount += c['amount'];
        if(j>1) {
            distribution[c['type']] += c['amount']
            distribution[c['cost']] += c['amount']
        }

        if(c['victory'] != undefined) {
            extra += `<span class="hook">${c['victory']}</span>
                <img class="hook-icon" src="icons/hook.svg" />`
        }

        if(c['cost'] != undefined) {
            extra += `<span class="cost">${c['cost']}</span>
                <img class="cost-icon" src="icons/chest.svg" />`
        }

        if(c['subtype'] != undefined) {
            extra += `<span class="subtype">${c['subtype']}</span>`
        }

        if(c['discard'] != undefined) {
            extra += `<span class="discard"><img src="icons/bookmark-yellow.svg" /></span>`
        }

        if(c['type'] == "attack") {
            extra += `<img class="attack-icon-1" src="icons/attack.svg" /><img class="attack-icon-2" src="icons/attack.svg" />`
        }

        if(c['type'] == "adventure") {
            extra += `<img class="tentacle-icon-1" src="icons/tentacle.svg" /><img class="tentacle-icon-2" src="icons/tentacle.svg" />`
        }

        if(c['type'] == "structure") {
            extra += `<img class="structure-icon-1" src="icons/structure.svg" /><img class="structure-icon-2" src="icons/structure.svg" />`
        }

        var template = `<div class="card" id="card-${j}">
            <div class="inner">
                <div class="front type-${c['type']}"> 
                    <div class="frame"><div></div></div>
                    <img src="${c['img']}" class="bg" />
                    
                    <span class="title">${c['title']}</span>
                    <span class="text">${c['text']}</span>
                    ${extra}

                    <div class="mpc">
                        <img src="mpc.png" />
                    </div>
                    <div class="mask"></div>
                </div>
                <div class="back">
                    <img src="back.png" />
                    <div class="mpc">
                        <img src="mpc.png" />
                    </div>
                </div>
            </div>
            <button onclick="downloadCard(this)">Download #${j+1}, copies: ${c['amount']}</button>
        </div>
        `
        all.push(template)
        j++;
        if(j % 9 == 0) {
            all.push('<div class="break"></div>')
        }
    })

    document.getElementById('nbCards').innerHTML = amount;
    document.getElementById('nbDesign').innerHTML = cards.length;
    
    document.getElementById('distribution').innerHTML = JSON.stringify(distribution, undefined, '\n');

    document.getElementById('cards').innerHTML = all.join('')

    function download(url, title) {
        var a = document.createElement('a')
        a.href=url
        a.download=title+".png"
        document.body.appendChild(a)
        a.click()
        a.remove()
    }

    function downloadCard(e) {
        console.log(this.target, e, e.parentNode)
        createImage(e.parentNode, (canvas, title) => {
            download(canvas.toDataURL("image/png"), title);
        })
    }

    function downloadBookletFace(e) {
        createImage(document.getElementById('face'), (canvas, title) => {
            download(canvas.toDataURL("image/png"), title);
        })
    }

    function downloadBookletBack(e) {
        createImage(document.getElementById('back'), (canvas, title) => {
            download(canvas.toDataURL("image/png"), title);
        })
    }

    function createImage(card, cb) {
        card.classList.add('preparePrint')
        setTimeout(() => {
            html2canvas(card, {scale: 6.5, backgroundColor: '#000000'}).then(function(canvas) {
                // canvas.width = 2220
                // canvas.height = 1632
                document.body.appendChild(canvas);
                if(card.title) {
                    var title = card.title;
                } else {
                    var title = card.querySelector('.title').textContent.toLocaleLowerCase().replace(' ', '-')
                }
                cb(canvas, title);
                // canvas.remove()
            })
        }, 100)
    }
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>


function bindImage(element, card, i) {
    setTimeout(() => {
        createImage(element, (canvas, title) => {
            card['canvas'] = canvas
        })
    }, i * 50)
}


document.getElementById('genPDF').onclick = generatePDF

function generatePDF(e) {
    console.log(e.target)
    e.target.disable = true;
    e.target.innerHTML = 'Please wait'
    var jsPDF = window.jspdf.jsPDF;
    var doc = new jsPDF({
        unit: "mm",
        format: [69, 94],
    });

    for (i=0; i<cards.length; i++) {
        var card = cards[i];
        var element = document.getElementById('card-'+card['id'])
        bindImage(element, card, i)
    }

    e.target.innerHTML = 'Rendering... Wait 10 seconds to be sure everything is finished.'

    setTimeout(() => {

        e.target.innerHTML = 'Starting PDF rendering.'
        firstPage = true;

        for (i=0; i<cards.length; i++) {
            var card = cards[i];
            e.target.innerHTML = 'Rendering page ' + card['title'];
            for (j=0; j<card.amount; j++) {
                if (firstPage) {
                    firstPage = false;
                } else {
                    doc.addPage()
                }
                doc.addImage(card['canvas'], "PNG", 0, 0, 69, 94, card['title'], "FAST", 0)
                doc.addPage()
                doc.addImage('back.png', "PNG", 0, 0, 69, 94, 'back', "FAST", 0)
            }
        }

        doc.save("MB-Print.pdf");
        e.target.innerHTML = 'Done!'
    }, 5000)

}

// createImage(document.querySelector('.card'), (canvas, title) => {
//     doc.addImage(canvas, "PNG", 0, 0, 69, 94, title, "MEDIUM", 0)
//     doc.addPage()
//     doc.addImage(canvas, "PNG", 0, 0, 69, 94, title, "MEDIUM", 0)
//     doc.addPage()
//     doc.addImage(canvas, "PNG", 0, 0, 69, 94, title, "MEDIUM", 0)
//     doc.save("a4.pdf");
// })


</script>

</html>