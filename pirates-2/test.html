<html>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Berkshire+Swash&family=Della+Respira&family=Lobster+Two:wght@400;700&family=Oleo+Script+Swash+Caps&family=Pirata+One&family=Playfair+Display&display=swap" rel="stylesheet">

<script src="html2canvas.js"></script>

<style>
    html {
        background-color: rgb(26, 23, 23);
        -webkit-print-color-adjust: exact;
        -webkit-filter: opacity(1);
        color: #fff;
        text-decoration: none;
    }

    .card {
        position: relative;
        background-color: transparent;
        width: 69.088mm;
        height: 93.98mm;
        float: left;
        margin: 16px 10px;
        perspective: 1000px;
    }

    .inner {
        position: relative;
        width: 100%;
        height: 100%;
        text-align: center;
        transition: transform 0.8s;
        transform-style: preserve-3d;
    }

    /* .card:hover .inner {
        transform: rotateY(180deg);
    } */

    .card .bg {
        width: 66.5mm;
        height: 91mm;
        margin-top: 1.5mm;
        /* border-radius: 5px; */
    }

    .card .mpc {
        position: absolute;
        top:0;
        left:0;
        width: 69.088mm;
        height: 93.98mm;
        /* border-radius: 5px; */
    }


    .card .mpc img {
        width: 69.088mm;
        height: 93.98mm;
    }

    .card .fg {
        width: 63mm;
        height: 88mm;
        position: absolute;
        top:0;
        left:0;
        opacity: 0.01;
    }
    .card .title {
        font-family: 'Berkshire Swash', cursive;
        font-family: 'Oleo Script Swash Caps', cursive;
        font-family: 'Pirata One';
        font-family: 'Lobster Two', cursive;
        letter-spacing: 0.1px;
        font-size: 16px;
        position: absolute;
        right:0;
        top:54.2mm;
        left:0;
        color: #ECEAC2;
        text-align: center;
        text-shadow: 1px 1px black;
    }
    .card .text {
        position: absolute;
        font-family: 'Della Respira', serif;
        font-size:11px;
        right:9mm;
        top:56mm;
        left:9mm;
        bottom:10.5mm;
        color: #fff2ca;
        text-align: center;
        text-shadow: 0.5px 0.5px black;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .card .subtype {
        font-family: 'Della Respira', serif;
        font-size: 10px;
        position: absolute;
        right:26mm;
        top:84mm;
        left:26mm;
        color: #ECEAC2;
        text-align: center;
        text-shadow: 1px 1px black;
        background-color: rgba(17, 15, 13, 0.9);
        border: 1px solid rgba(231, 185, 48, 0.9);
        border-radius: 5px;
        box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.70);
        /* try to fix rendering bug */
        padding-bottom: 2px;
        display: flex;
        align-content: center;
        flex-direction: column;
        height:1.3em;
    }

    .card .frame {
        position: absolute;
        right:6mm;
        top:52mm;
        left:6mm;
        bottom:6mm;
        border-radius: 6px;
        border: 1px solid rgba(231, 185, 48, 0.608);
        box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.5);
    }

    .card .frame div {
        position: absolute;
        right:0.65mm;
        top:0.65mm;
        left:0.65mm;
        bottom:0.65mm;
        border-radius: 5px;
        border: 1px solid rgba(231, 185, 48, 0.9);
        background-color: rgba(14, 14, 13, 0.7);
    }

    .card .text span {
        font-family: 'Lobster Two', cursive;
        display: contents;
    }

    .role .subtype {
        right: 30mm;
        left: 19mm;
    }
    .role .frame {
        right:18mm;
        top:44mm;
    }
    .role .title {
        right: 12mm;
        top: 47mm;
    }
    .role .text {
        right: 22mm;
        top: 50mm;
    }

    .card .life, .card .life-enemy {
        font-family: 'Lobster Two', cursive;
        font-size: 16px;
        right: 17px;
        top: 26px;
        bottom:0;
        position: absolute;
        left:51.5mm;
        color: #fff7d4;
        text-align: center;
        text-shadow: 1px 1px 2px black, 0px 0px 1px black;
    }

    .card .life-enemy {
        left:6.7mm;
        right:0;
        display: flex;
    }

    .life-enemy span {
        display: inline-block;
        padding: 9px 0px;
        width: 35.4px;
    }

    .life span {
        display: block;
        padding: 8.8px 13px;
    }


    .prestige {
        font-family: 'Lobster Two', cursive;
        color: #fff2ca;
        font-size: 15px;
        position: absolute;
        left: 57.5mm;
        top: 79.6mm;
        text-shadow: 1px 1px black;
    }

    .attack {
        font-family: 'Lobster Two', cursive;
        color: #fff2ca;
        font-size: 15px;
        position: absolute;
        left: 57.5mm;
        top: 79.6mm;
        text-shadow: 1px 1px black;
    }
    .attack-icon-state {
        position:absolute;
        left: 50mm;
        top: 79.5mm;
    }
    .hook-icon {
        position:absolute;
        left: 51mm;
        top: 79.3mm;
    }
    .shell-icon-1 {
        position:absolute;
        left: 6mm;
        top: 49mm;
    }
    .shell-icon-2 {
        position:absolute;
        right: 6mm;
        top: 49mm;
    }
    .attack-icon-1 {
        position:absolute;
        left: 7mm;
        top: 49mm;
    }
    .attack-icon-2 {
        position:absolute;
        right: 7mm;
        top: 49mm;
    }
    .spell-icon-1 {
        position:absolute;
        left: 7mm;
        top: 49mm;
    }
    .spell-icon-2 {
        position:absolute;
        right: 7mm;
        top: 49mm;
    }

    .react-icon-1 {
        position:absolute;
        left: 7mm;
        top: 52mm;
    }
    .react-icon-2 {
        position:absolute;
        right: 7mm;
        top: 52mm;
    }

    .tentacle-icon-1 {
        position:absolute;
        left: 7mm;
        top: 46.4mm;
        transform: scaleX(-1);
        opacity: 0.90;
    }
    .tentacle-icon-2 {
        position:absolute;
        right: 7mm;
        top: 46.4mm;
        opacity: 0.90;
    }

    .health {
        font-family: 'Lobster Two', cursive;
        color: #fff2ca;
        font-size: 15px;
        position: absolute;
        left: 15.6mm;
        top: 79.6mm;
        text-shadow: 1px 1px black;
    }
    .health-icon {
        position:absolute;
        left: 9mm;
        top: 79.3mm;
    }

    /* Position the front and back side */
    .front, .back {
        position: absolute;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden; /* Safari */
        backface-visibility: hidden;
    }

    /* Style the back side */
    .back {
        display: none;
        transform: rotateY(180deg);
    }
    .back img {
        width: 100%;
        height: 100%;
        border-radius: 5px;
    }
    .break {
        width:100%;
        height: 1px;
        page-break-after: always;
    }

    @media print {
        @page {
            size: 210mm 297mm;
        }
        @page {
            size: 420mm 594mm;
        }
        body {
            zoom: 2;
        }
        .back img {
            display: none;
        }
    }

    .preparePrint button {
        display: none;
    }
    .preparePrint .mpc {
        display: none;
    }
    .preparePrint.card .bg {
        border-radius: 0;
    }


</style>

<body>
    <h2>Pirate Deck Builder Game</h2>
    <p>
        From 2 to 4 players.
        Set up the game using a classic deck of cards. Assign each card number
        to each type of card. E.g. the 4 aces are the Sail Away cards. Only Celebrate requires
        6 cards (for 2 players). Either use another deck to complete or use the jokers.
    </p>

    <ol>
        <li>
            Each player receives a deck of 2 Sail Away and 3 Celebrate: 5 cards in all.
        </li>
        <li>
            All remaining cards are placed face up on the table in piles of 4 per type (all 3 goes in one pile, etc.).
        </li>
    </ol>

    <p>
        Unfolding of the game, each player in turn:
    </p>

    <ol>
        <li>The player begins by discarding his hand and drawing 3 cards</li>
        <li>Each player has 2 actions during his turn</li>
        <li>Playing a card or buying a card is an action</li>
        <li>Played or purchased cards go to your discard pile</li>
        <li>When your deck is empty, shuffle your discard pile, this is your deck</li>
    </ol>

    <p>
        Game details:
    </p>

    <ol>
        <li>Treasures are small cubes that allow you to buy cards (cost of the card at the bottom right)</li>
        <li>+1 Card: draw a card</li>
        <li>+1 Action: one more action</li>
        <li>+1 Treasure: take a treasure from the bank</li>
        <li>The cards have 3 possible types: Attack, Structure, Adventure</li>
        <li>Text that say "if you have an/a" checks the cards currently in your hand.</li>
        <li>Text on the cards has to be applied in order.</li>
    </ol>

    <p>The game ends when a player has 16 cards in his or her deck. End the round so that everyone has played. 
        Count the number of hooks in each deck (bottom left).
        The player with the most points wins the game.
    </p>

    <div id="cards"></div>
</body>

<script>
    var cards = [

    {
            'title': 'Sail away!',
            'text': '+1 Treasure',
            'img': 'adventures/ship-sea-calm.png',
            'type': 'monster',
            'subtype': 'Attack',
            'hp': '0',
            'cost': '1'
        },

        {
            'title': 'Celebrate',
            'text': '+1 Card<br><i>(Draw a card)</i>',
            'img': 'adventures/drink-dead.jpeg',
            'type': 'monster',
            'subtype': 'Adventure',
            'hp': '1',
            'cost': '1'
        },

        // {
        //     'title': 'Quick shot',
        //     'text': '+1 Card<br>+1 Action',
        //     'img': 'crew-actions/attack-0.jpg',
        //     'type': 'monster',
        //     'subtype': 'Attack',
        //     'hp': '1',
        //     'cost': '1'
        // },

        {
            'title': 'Tree Guardian',
            'text': '+2 Card if you have an adventure<br>+1 Action if you have a structure.',
            'img': 'adventures/wraith.png',
            'type': 'monster',
            'subtype': 'Adventure',
            'hp': '1',
            'cost': '1'
        },

        {
            'title': 'Raid',
            'text': '+1 Treasure<br>+1 Action if you have an attack.',
            'img': 'adventures/pirate-sunset-2.png',
            'type': 'monster',
            'subtype': 'Attack',
            'cost': 1,
            'hp': 1,
        },


        {
            'title': 'Plunder!',
            'text': 'Take a treasure from another player<br>OR +1 Treasure.',
            'img': 'adventures/governor.jpeg',
            'type': 'monster',
            'subtype': 'Attack',
            'cost': '1',
            'hp': '1',
        },

        // {
        //     'title': 'Mary Read',
        //     'text': 'Attack value X is the number of started expeditions.',
        //     'img': 'adventures/ship-sea-calm.png',
        //     'type': 'monster',
        //     'subtype': 'Enemy',
        // },

        {
            'title': 'Pirate hideout',
            'text': '+2 Cards, +1 Treasure<br>You can discard this at any point to cancel an effect targeting you.',
            'img': 'crew-actions/pirate-town.jpg',
            'type': 'monster',
            'subtype': 'Structure',
            'cost': '2',
            'hp': '2'
        },

        {
            'title': 'Market',
            'text': '+2 Treasure',
            'img': 'crew-actions/market.jpg',
            'type': 'monster',
            'subtype': 'Structure',
            'cost': '2',
            'hp': '2',
        },

        {
            'title': 'Exploration',
            'text': '+1 Card, +1 Treasure<br>+1 Action if you have an adventure.',
            'img': 'adventures/snake-guardian-2.png',
            'type': 'monster',
            'subtype': 'Adventure',
            'cost': '2',
            'hp': '2',
        },

        {
            'title': 'Going Ape',
            'text': '+1 Action, +1 Card<br>You may remove a card in your hand from the game. Replace it with a card of equal cost.',
            'img': 'adventures/ape.png',
            'type': 'monster',
            'subtype': 'Attack',
            'hp': '2',
            'cost': '2'
        },

        {
            'title': 'Haunted Shipwreck',
            'text': '+2 Cards<br>+1 Treasure for each attack in your hand.',
            'img': 'adventures/haunted-shipwreck.png',
            'type': 'monster',
            'subtype': 'Structure',
            'hp': '2',
            'cost': '2'
        },

        {
            'title': 'Citadel',
            'text': '+1 Card<br>+2 Actions.',
            'img': 'adventures/citadel.png',
            'type': 'monster',
            'subtype': 'Structure',
            'cost': '3',
            'hp': '2'
        },

        {
            'title': 'Voodoo Curse',
            'text': 'Look at the 2 top card of target player deck: you can discard one and apply its effects.',
            'img': 'crew-actions/spell.jpeg',
            'type': 'monster',
            'subtype': 'Adventure',
            'hp': '2',
            'cost': '3'
        },

        {
            'title': 'Skull island',
            'text': '+2 Treasure<br>On their next turn, all other players discard a card they drew.',
            'img': 'adventures/skull.png',
            'type': 'monster',
            'subtype': 'Structure',
            'hp': '3',
            'cost': '4'
        },

    ]

    all = []
    var j = 0;
    cards.forEach((c) => {
        var extra = ""
        if(c['prestige'] != undefined) {
            extra += `<span class="prestige">${c['prestige']}</span>
                <img class="hook-icon" src="icons/hook.svg" />`
        }
        if(c['hp'] != undefined) {
            extra += `<span class="health">${c['hp']}</span>
                <img class="health-icon" src="icons/hook.svg" />`
        }
        if(c['attack'] != undefined) {
            extra += `<span class="attack">${c['attack']}</span>
                <img class="attack-icon-state" src="icons/attack-white.svg" />`
        }

        if(c['cost'] != undefined) {
            extra += `<span class="attack">${c['cost']}</span>
                <img class="attack-icon-state" src="icons/chest.svg" />`
        }

        if(c['subtype'] != undefined) {
            extra += `<span class="subtype">${c['subtype']}</span>`
        }
        if(c['type'] == "crew") {
            extra += `<img class="shell-icon-1" src="icons/shell.svg" /><img class="shell-icon-2" src="icons/shell.svg" />`
        }
        if(c['type'] == "crew-attack" || c['type'] == "monster-attack") {
            extra += `<img class="attack-icon-1" src="icons/attack.svg" /><img class="attack-icon-2" src="icons/attack.svg" />`
        }
        if(c['type'] == "crew-spell") {
            extra += `<img class="spell-icon-1" src="icons/spell.svg" /><img class="spell-icon-2" src="icons/spell.svg" />`
        }
        if(c['type'] == "crew-react") {
            extra += `<img class="react-icon-1" src="icons/trap.svg" /><img class="react-icon-2" src="icons/trap.svg" />`
        }
        if(c['type'] == "monster") {
            extra += `<img class="tentacle-icon-1" src="icons/tentacle.svg" /><img class="tentacle-icon-2" src="icons/tentacle.svg" />`
        }

        if(c['type'] == "role") {
            extra += `<div class="life">`
            for(var i=7; i>0; i--) {
                extra += `<span class='life-${i}'>${i}</span>`
            }
            extra += "</div>"
        }

        if(c['type'] == "role") {
            extra += `<div class="life">`
            for(var i=7; i>0; i--) {
                extra += `<span class='life-${i}'>${i}</span>`
            }
            extra += "</div>"
            if(c['title'] == "Enemy") {
                extra += `<div class="life-enemy">`
                for(var i=12; i>7; i--) {
                    extra += `<span class='life-enemy-${i}'>${i}</span>`
                }
                extra += "</div>"
            }
        }

        // <img src='frames/${c['type']}-frame.svg' class="fg" />
        // 1

        // html2canvas(document.body).then(function(canvas) {
        //     document.body.appendChild(canvas);
        // });

        var template = `<div class="card">
            <div class="inner">
                <div class="front ${c['type']}"> 
                    <div class="frame"><div></div></div>
                    <img src="${c['img']}" class="bg" />
                    
                    <span class="title">${c['title']}</span>
                    <span class="text">${c['text']}</span>
                    ${extra}

                    <div class="mpc">
                        <img src="mpc.png" />
                    </div>
                </div>
                <div class="back">
                    <img src="crew/back.png" />
                </div>
            </div>
            <button onclick="downloadCard(this)">Download #${j+1}</button>
        </div>
        `
        all.push(template)
        j++;
        if(j % 9 == 0) {
            all.push('<div class="break"></div>')
        }
    })

    document.getElementById('cards').innerHTML = all.join('')

    function download(url, title) {
        var a = document.createElement('a')
        a.href=url
        a.download=title+".png"
        document.body.appendChild(a)
        a.click()
        a.remove()
    }

    function downloadCard(e) {
        console.log(this.target, e, e.parentNode)
        e.parentNode.classList.add('preparePrint')
        setTimeout(() => {
            html2canvas(e.parentNode, {scale: 6.5, backgroundColor: '#000000'}).then(function(canvas) {
                // canvas.width = 2220
                // canvas.height = 1632
                document.body.appendChild(canvas);
                var title = e.parentNode.querySelector('.title').textContent.toLocaleLowerCase().replace(' ', '-')
                download(canvas.toDataURL("image/png"), title);
                // canvas.remove()
            })
        }, 100)
    }

    console.log(cards.length)
</script>


</html>