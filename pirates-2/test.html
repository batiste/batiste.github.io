<html>
<head>
<meta charset="UTF-8">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Berkshire+Swash&family=Della+Respira&family=Lobster+Two:wght@400;700&family=Oleo+Script+Swash+Caps&family=Pirata+One&family=Playfair+Display&display=swap" rel="stylesheet">

<script src="html2canvas.js"></script>

<style>
    html {
        background-color: 2a2a2a;
        -webkit-print-color-adjust: exact;
        -webkit-filter: opacity(1);
        color: #fff;
        text-decoration: none;
    }

    a, a:visited {
        color: #fff;
    }

    .card {
        position: relative;
        background-color: transparent;
        width: 69.088mm;
        height: 93.98mm;
        float: left;
        margin: 16px 10px;
        perspective: 1000px;
    }

    .mask {
        border: 2mm solid black;
        border-radius: 3mm;
        position: absolute;
        top: 3.05mm;
        left: 3mm;
        bottom: 3mm;
        right: 3mm;
    }

    .inner {
        position: relative;
        width: 100%;
        height: 100%;
        text-align: center;
        transition: transform 0.8s;
        transform-style: preserve-3d;
        background-color: #000;
    }

    .card:hover .inner {
        transform: rotateY(180deg);
    }

    .card .bg {
        /* 63 88 is poker size */
        width: 59mm;
        height: 84mm;
        margin-top: 5mm;
        /* border-radius: 5px; */
    }

    .card .mpc {
        position: absolute;
        top:0;
        left:0;
        width: 69.088mm;
        height: 93.98mm;
        /* border-radius: 5px; */
    }

    .card .mpc img {
        width: 69.088mm;
        height: 93.98mm;
    }

    .card .fg {
        width: 63mm;
        height: 88mm;
        position: absolute;
        top:0;
        left:0;
        opacity: 0.01;
    }
    .card .title {
        font-family: 'Berkshire Swash', cursive;
        font-family: 'Oleo Script Swash Caps', cursive;
        font-family: 'Pirata One';
        font-family: 'Lobster Two', cursive;
        letter-spacing: 0.1px;
        font-size: 16px;
        position: absolute;
        right:0;
        top:56mm;
        left:0;
        color: #DFC13F;
        color: #ECEAC2;
        color: #f7e8a7;
        text-align: center;
        text-shadow: 1px 2px black;
    }
    .card .text {
        position: absolute;
        font-family: 'Della Respira', serif;
        font-size:10px;
        right:9mm;
        top:56.5mm;
        left:9mm;
        bottom:10.5mm;
        color: #fff2ca;
        text-align: center;
        text-shadow: 0.5px 0.5px black;
        display: flex;
        flex-direction: column;
        justify-content: center;
        line-height: 1.45;
    }

    .rules {
        font-family: 'Della Respira', serif;
        font-size:13px;
        color: #ffffff;
        text-align: left;
        line-height: 1.45;
        max-width: 50%;
        float:left
    }

    .card .rules ol {
        margin: 0;
        padding: 0;
        padding-left: 1em;
    }

    .card .rules p {
        margin: 0;
        padding: 0;
        margin-bottom: 8px;
    }

    .card .subtype {
        font-family: 'Della Respira', serif;
        font-size: 10px;
        position: absolute;
        right:26mm;
        top:83.2mm;
        left:26mm;
        color: #ECEAC2;
        text-align: center;
        text-shadow: 1px 1px black;
        background-color: rgba(17, 15, 13, 0.91);
        border: 1px solid rgba(231, 185, 48, 0.9);
        border-radius: 5px;
        box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.70);
        padding-bottom: 0.4mm;
        display: flex;
        align-content: center;
        flex-direction: column;
    }

    .card .frame {
        position: absolute;
        right:6.5mm;
        top:54mm;
        left:6.5mm;
        bottom:6.7mm;
        border-radius: 7px;
        background-color: rgba(0, 0, 0, 0.2);
        border: 0.8px solid rgba(231, 185, 48, 0.608);
        box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.5);
    }

    .card .frame div {
        position: absolute;
        right:0.65mm;
        top:0.65mm;
        left:0.65mm;
        bottom:0.65mm;
        border-radius: 5px;
        border: 1px solid rgba(231, 185, 48, 0.9);
        background-color: rgba(14, 14, 13, 0.58);
    }

    .card .text span {
        font-family: 'Lobster Two', cursive;
        display: contents;
    }

    .cost {
        font-family: 'Lobster Two', cursive;
        color: #fff2ca;
        font-size: 15px;
        position: absolute;
        left: 57.6mm;
        top: 79.6mm;
        text-shadow: 1px 1px black;
    }

    .cost-icon {
        position:absolute;
        left: 50mm;
        top: 79.4mm;
    }

    .hook {
        font-family: 'Lobster Two', cursive;
        color: #fff2ca;
        font-size: 15px;
        position: absolute;
        left: 16mm;
        top: 79.6mm;
        text-shadow: 1px 1px black;
    }

    .hook-icon {
        position:absolute;
        left: 9.6mm;
        top: 79.1mm;
    }

    .attack-icon-1 {
        position:absolute;
        left: 8.5mm;
        top: 51mm;
    }
    .attack-icon-2 {
        position:absolute;
        right: 8.5mm;
        top: 51mm;
    }

    .structure-icon-1 {
        position:absolute;
        left: 8mm;
        top: 49mm;
    }
    .structure-icon-2 {
        position:absolute;
        right: 8mm;
        top: 49mm;
    }

    .tentacle-icon-1 {
        position:absolute;
        left: 8mm;
        top: 48.4mm;
        transform: scaleX(-1);
    }
    .tentacle-icon-2 {
        position:absolute;
        right: 8mm;
        top: 48.4mm;
    }

    /* Position the front and back side */
    .front, .back {
        position: absolute;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden; /* Safari */
        backface-visibility: hidden;
    }

    /* Style the back side */
    .back {
        /* display: none; */
        transform: rotateY(180deg);
    }
    .back img {
        width: 100%;
        height: 100%;
        border-radius: 5px;
    }
    .break {
        width:100%;
        height: 1px;
        page-break-after: always;
    }

    @media print {
        @page {
            size: 210mm 297mm;
        }
        @page {
            size: 420mm 594mm;
        }
        body {
            zoom: 2;
        }
        .back img {
            display: none;
        }
    }

    .preparePrint button {
        display: none;
    }
    .preparePrint .mpc {
        display: none;
    }
    .preparePrint.card .bg {
        border-radius: 0;
    }
    .preparePrint.card .subtype {
        padding-bottom: 0.5mm;
    }

    .preparePrint .back {
        display: none;
    }

    /* display: none; */


</style>
</head>

<body>

<div class="rules">

    <h2>Deckhand</h2>

    <p>
       A Pirate themed deck builder Game for 2 to 4 players. <span id="nbCards"></span> cards in the game.
    </p>

    <ol>
        <li>
            Each player receives a deck of 2 Fist Fight and 2 Celebrate: 4 cards in all.
            Remove all remaining Fist Fight and Celebrate from the game.
        </li>
        <li>
            All remaining cards are shuffled and form the supply deck. Reveal 6 cards by putting them face up
            in the center of the table, this is the supply.
        </li>
        <li>
            There should always be 6 supply cards face up. Replace them as you go.
        </li>
    </ol>

    <p>
        Unfolding of the game, each player in turn:
    </p>

    <ol>
        <li>Apply effects that happen at the beginning of turn.</li>
        <li>Discard your hand and draw 3 cards.</li>
        <li>You can do 2 actions of any kind during your turn. Possible actions are:
            <ol>
                <li>Playing a card: Apply its effects first, then put it in your discard pile.</li>
                <li>Buying a card from the supply: It goes in your discard pile.</li>
            </ol>
         </li>
        <li>When your deck is empty immediately shuffle your discard pile: this is your new deck.</li>
    </ol>

</div>
<div class="rules">

    <p>
        Game details
    </p>

    <ul>
        <li>Treasures are the money that allow you to buy cards (cost is the chest icon at the bottom right).</li>
        <li>+1 Card: Draw a card immediately.</li>
        <li>+1 Action: One more action of any kind during this turn.</li>
        <li>+1 Supply refresh: You may change one card from the supply. Put the old one at the bottom of the supply deck.</li>
        <li>+1 Treasure: Take a treasure from the bank immediately.</li>
        <li>+1 Buy: You may buy a card without using an action this turn.</li>
        <li>The cards have 3 possible types: Attack, Structure, Adventure.</li>
        <li>Text that say "if you have an/a" checks the cards currently in your hand.</li>
        <li>Text on the cards has to be applied in order if it matters to the type checks.</li>
        <li>Discard piles are face up and can be inspected by anybody.</li>
    </ul>

    <p>End of the game</p>

    <p>The game ends when any player has more than 15 cards in total. End the round so that everyone has played. 
       Add the number of hooks in each deck (hook icon at the bottom left). The player with the most hooks wins the game. 
       If there is equality, the player with the most Treasures wins, then the player with the most cards.
    </p>

</div>

<div style="clear:both;padding-top:20px">

<div id="distribution"></div>
<button id="genPDF">Create MB Print compatible PDF</button>

</div>

<div id="cards"></div>


</body>

<script>
    var cards = [

    {
            'title': 'Fist Fight',
            'text': '+1 Treasure.',
            'img': 'attacks/fist-fight.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '1',
            'cost': '1',
            'amount': 2 * 4
        },

        {
            'title': 'Celebrate',
            'text': '+1 Card.<br>+1 Supply refresh.',
            'img': 'adventures/drink-dead.jpeg',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '1',
            'cost': '1',
            'amount': 2 * 4
        },

        {
            'title': 'Tavern',
            'text': '+1 Card if you have an Adventure.<br>+1 Treasure if you have an Attack.<br>+1 Action if you have a Structure.',
            'img': 'adventures/tavern-2.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '1',
            'cost': '1',
            'amount': 4,
        },

        {
            'title': 'Quick Shot',
            'text': '+1 Treasure.<br>+1 Action if you have an Attack.',
            'img': 'attacks/quick-shot.jpg',
            'type': 'attack',
            'subtype': 'Attack',
            'cost': 1,
            'victory': 1,
            'amount': 4,
        },

        {
            'title': 'Haggling',
            'text': '+1 Supply refresh, +1 Buy.<br>You next buy this turn cost 1 less.',
            'img': 'attacks/bargaining.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '1',
            'cost': '1',
            'amount': 3,
        },

        {
            'title': 'Hideout',
            'text': '+2 Cards, +1 Treasure.<br> The first time you must discard this card from your hand, you may not.',
            'img': 'structures/hideout.png',
            'type': 'structure',
            'subtype': 'Structure',
            'cost': '2',
            'victory': '2',
            'amount': 3
        },

        {
            'title': 'Harbor Market',
            'text': '+2 Treasures.<br>OR<br>+1 Treasure, +1 Buy.',
            'img': 'structures/market-super-format.png',
            'type': 'structure',
            'subtype': 'Structure',
            'cost': '2',
            'victory': '2',
            'amount': 4
        },

        {
            'title': 'Exploration',
            'text': '+1 Action if you have an Adventure.<br>+1 Card, +1 Treasure.',
            'img': 'adventures/snake-guardian-2.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'cost': '2',
            'victory': '2',
            'amount': 4
        },

        {
            'title': 'Going Ape',
            'text': '+1 Action, +1 Supply refresh.<br>You may swap a card from your hand with a card of equal cost from the supply.',
            'img': 'attacks/silverback.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '2',
            'cost': '2',
            'amount': 2
        },

        {
            'title': 'Haunted Cave',
            'text': '+2 Card.<br>+1 Treasure for each Attack in your hand.',
            'img': 'attacks/infested-cave.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '2',
            'cost': '2',
            'amount': 3
        },

        {
            'title': 'Lost Expedition',
            'text': 'Put a card from any discard pile aside with a Treasure on it. When the discard pile is shuffled take the Treasure and put the card back in the new discard pile.',
            'img': 'adventures/tropical-island-2.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'cost': '2',
            'victory': '2',
            'amount': 3
        },

        {
            'title': 'Seaside Citadel',
            'text': 'You can’t gain more than 3 extra Actions this turn.<br>+1 Card, +2 Actions.',
            'img': 'structures/citadel.png',
            'type': 'structure',
            'subtype': 'Structure',
            'cost': '3',
            'victory': '2',
            'amount': 3
        },

        {
            'title': 'Voodoo Curse',
            'text': 'Reveal the top 2 cards of target player’s deck. Discard one, then apply its effects as if you just played it.',
            'img': 'attacks/spell.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '2',
            'cost': '3',
            'amount': 3
        },

        {
            'title': 'Smuggler’s Cache',
            'text': '+1 Treasure.<br>At the start of your turn if this card is in your discard pile: +1 Treasure.',
            'img': 'structures/smugglers-cache.png',
            'type': 'structure',
            'subtype': 'Structure',
            'victory': '2',
            'cost': '3',
            'amount': 2
        },

        {
            'title': 'Wind in Sails',
            'text': '+1 Card.<br>At the start of your turn if this card is in your discard pile: Draw an extra card during you normal draw.',
            'img': 'adventures/wind.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '2',
            'cost': '3',
            'amount': 2
        },

        {
            'title': 'Leviathan',
            'text': 'Steal up to 2 Treasures from any players.<br>OR<br>Put 1 card from any discard pile to the bottom of their owner’s deck.',
            'img': 'attacks/leviathan.jpg',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '3',
            'cost': '4',
            'amount': 2
        },

        {
            'title': 'Skull island',
            'text': 'Every player reveal the top card of their deck. You may swap one of those cards with another from the supply as long as the cost difference is one or less.',
            'img': 'structures/skull.png',
            'type': 'structure',
            'subtype': 'Structure',
            'victory': '3',
            'cost': '4',
            'amount': 2
        },

        {
            'title': 'Useless Totem',
            'text': 'Reveal this card: Change its type until you discard it. This is not an action. It can be done at any time and only once per turn.',
            'img': 'structures/totem.png',
            'type': 'structure',
            'subtype': 'Structure',
            'victory': '2',
            'cost': '1',
            'amount': 2
        },

        {
            'title': 'Extravagance',
            'text': '+2 Buy.<br>OR<br>+1 Treasure.',
            'img': 'adventures/shopping.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '2',
            'cost': '2',
            'amount': 2
        },

        {
            'title': 'Shipyard',
            'text': 'You can’t gain more than 3 extra Actions this turn.<br>+1 Card. +1 Action for each structure in your discard pile.',
            'img': 'structures/shipyard.png',
            'type': 'structure',
            'subtype': 'Structure',
            'victory': '2',
            'cost': '2',
            'amount': 2
        },


        {
            'title': 'Walk the Plank',
            'text': 'Put a card from your hand or discard pile at the bottom of the supply: +3 Treasures.<br>OR<br>+1 Treasure.',
            'img': 'attacks/plank.png',
            'type': 'attack',
            'subtype': 'Attack',
            'victory': '2',
            'cost': '3',
            'amount': 2
        },

        {
            'title': 'Treasure Hunt',
            'text': '+1 Action, +1 Buy,<br>+1 Card, +1 Treasure.',
            'img': 'adventures/treasure-hunt.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '2',
            'cost': '4',
            'amount': 2
        },

        {
            'title': 'Merfolk Mercenary',
            'text': 'Pay 1 Treasure: Reveal the top 2 cards of the supply and put one in your discard pile.',
            'img': 'adventures/merfolk-2.png',
            'type': 'adventure',
            'subtype': 'Adventure',
            'victory': '2',
            'cost': '3',
            'amount': 2
        },

    ]

    all = []
    var j = 0;
    var amount = 0;
    var distribution = {'attack': 0, 'structure': 0, 'adventure': 0, 1: 0, 2: 0, 3: 0, 4: 0, nb_cards_necessary_total:(16 * 4 + 6 + 2)}

    cards.forEach((c) => {
        var extra = ""
        c['id'] = j;
        amount += c['amount'];
        if(j>1) {
            distribution[c['type']] += c['amount']
            distribution[c['cost']] += c['amount']
        }

        if(c['victory'] != undefined) {
            extra += `<span class="hook">${c['victory']}</span>
                <img class="hook-icon" src="icons/hook.svg" />`
        }

        if(c['cost'] != undefined) {
            extra += `<span class="cost">${c['cost']}</span>
                <img class="cost-icon" src="icons/chest.svg" />`
        }

        if(c['subtype'] != undefined) {
            extra += `<span class="subtype">${c['subtype']}</span>`
        }

        if(c['type'] == "attack") {
            extra += `<img class="attack-icon-1" src="icons/attack.svg" /><img class="attack-icon-2" src="icons/attack.svg" />`
        }

        if(c['type'] == "adventure") {
            extra += `<img class="tentacle-icon-1" src="icons/tentacle.svg" /><img class="tentacle-icon-2" src="icons/tentacle.svg" />`
        }

        if(c['type'] == "structure") {
            extra += `<img class="structure-icon-1" src="icons/structure.svg" /><img class="structure-icon-2" src="icons/structure.svg" />`
        }

        var template = `<div class="card" id="card-${j}">
            <div class="inner">
                <div class="front type-${c['type']}"> 
                    <div class="frame"><div></div></div>
                    <img src="${c['img']}" class="bg" />
                    
                    <span class="title">${c['title']}</span>
                    <span class="text">${c['text']}</span>
                    ${extra}

                    <div class="mpc">
                        <img src="mpc.png" />
                    </div>
                    <div class="mask"></div>
                </div>
                <div class="back">
                    <img src="back.png" />
                    <div class="mpc">
                        <img src="mpc.png" />
                    </div>
                </div>
            </div>
            <button onclick="downloadCard(this)">Download #${j+1}, copies: ${c['amount']}</button>
        </div>
        `
        all.push(template)
        j++;
        if(j % 9 == 0) {
            all.push('<div class="break"></div>')
        }
    })

    document.getElementById('nbCards').innerHTML = amount;
    document.getElementById('distribution').innerHTML = JSON.stringify(distribution, undefined, '\n');

    document.getElementById('cards').innerHTML = all.join('')

    function download(url, title) {
        var a = document.createElement('a')
        a.href=url
        a.download=title+".png"
        document.body.appendChild(a)
        a.click()
        a.remove()
    }

    function downloadCard(e) {
        console.log(this.target, e, e.parentNode)
        createImage(e.parentNode, (canvas, title) => {
            download(canvas.toDataURL("image/png"), title);
        })
    }

    function createImage(card, cb) {
        card.classList.add('preparePrint')
        setTimeout(() => {
            html2canvas(card, {scale: 6.5, backgroundColor: '#000000'}).then(function(canvas) {
                // canvas.width = 2220
                // canvas.height = 1632
                document.body.appendChild(canvas);
                var title = card.querySelector('.title').textContent.toLocaleLowerCase().replace(' ', '-')
                cb(canvas, title);
                // canvas.remove()
            })
        }, 100)
    }

    console.log(cards.length)
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>


function bindImage(element, card, i) {
    setTimeout(() => {
        createImage(element, (canvas, title) => {
            card['canvas'] = canvas
        })
    }, i * 50)
}


document.getElementById('genPDF').onclick = generatePDF

function generatePDF(e) {
    console.log(e.target)
    e.target.disable = true;
    e.target.innerHTML = 'Please wait'
    var jsPDF = window.jspdf.jsPDF;
    var doc = new jsPDF({
        unit: "mm",
        format: [69, 94],
    });

    for (i=0; i<cards.length; i++) {
        var card = cards[i];
        var element = document.getElementById('card-'+card['id'])
        bindImage(element, card, i)
    }

    e.target.innerHTML = 'Rendering... Wait 10 seconds to be sure everything is finished.'

    setTimeout(() => {

        e.target.innerHTML = 'Starting PDF rendering.'
        firstPage = true;

        for (i=0; i<cards.length; i++) {
            var card = cards[i];
            e.target.innerHTML = 'Rendering page ' + card['title'];
            for (j=0; j<card.amount; j++) {
                if (firstPage) {
                    firstPage = false;
                } else {
                    doc.addPage()
                }
                doc.addImage(card['canvas'], "PNG", 0, 0, 69, 94, card['title'], "FAST", 0)
                doc.addPage()
                doc.addImage('back.png', "PNG", 0, 0, 69, 94, 'back', "FAST", 0)
            }
        }

        doc.save("MB-Print.pdf");
        e.target.innerHTML = 'Done!'
    }, 5000)

}

// createImage(document.querySelector('.card'), (canvas, title) => {
//     doc.addImage(canvas, "PNG", 0, 0, 69, 94, title, "MEDIUM", 0)
//     doc.addPage()
//     doc.addImage(canvas, "PNG", 0, 0, 69, 94, title, "MEDIUM", 0)
//     doc.addPage()
//     doc.addImage(canvas, "PNG", 0, 0, 69, 94, title, "MEDIUM", 0)
//     doc.save("a4.pdf");
// })


</script>

</html>